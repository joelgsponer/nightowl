# FILES.md

This document provides an overview of the `nightowl` R package repository structure, detailing the purpose and contents of key files and directories.

## Repository Structure

### Root Level Files

- **DESCRIPTION** - R package metadata including dependencies, version, and package information
- **NAMESPACE** - Generated by roxygen2; defines package exports and imports (do not edit manually)
- **LICENSE** / **LICENSE.md** - MIT license files for the package
- **README.md** - Main package documentation and getting started guide
- **SECURITY.md** - Security policy and reporting guidelines
- **NEWS.md** - Package changelog and release history
- **Makefile** - Build automation with commands for testing, documentation, and styling
- **CLAUDE.md** - Claude Code AI assistant guidance for working with this repository
- **_pkgdown.yml** - Configuration for pkgdown documentation website

### Core Directories

#### `/R/` - Package Source Code
The main R package source code, organized by functionality:

**Core R6 Classes:**
- `plot.R` - Main Plot R6 class with SVG rendering, HTML output, and memoization
- `Summary.r` - Summary R6 class for statistical summaries and data aggregation
- `coxph.R` - Coxph R6 class for Cox proportional hazards modeling and survival analysis

**Plotting and Visualization:**
- `add_plots.R` - Functions for adding various plot types to Plot objects
- `forest.R` - Forest plot implementations for effect sizes and confidence intervals
- `km.R` - Kaplan-Meier survival curve plotting functions
- `inline_plots.R` - Inline plotting functions for embedding in documents
- `donut_plot.R` - Donut chart implementations
- `plot_stacked_percentages.R` - Stacked percentage visualization functions

**Statistical Analysis:**
- `summaries.R` - Summary functions (`summarise_*` family) for various data types
- `survival.R` - Survival analysis utilities and helper functions
- `tests.R` - Statistical test implementations (chi-square, t-tests, Kruskal-Wallis)
- `ci.R` - Confidence interval calculations
- `percentage.R` - Percentage calculation and formatting utilities

**Data Manipulation and Utilities:**
- `data.R` - Data processing and transformation functions
- `utils.r` - General utility functions
- `utils-pipe.R` - Pipe operator utilities
- `validation.R` - Input validation and error handling
- `errors.R` - Error handling and messaging functions

**Styling and Theming:**
- `styles.R` - Plot styling and theme management
- `theming.R` - Theme-related functions and customizations
- `colors.R` - Color palette and color management functions
- `labels.R` - Label formatting and text utilities

**Interactive and Rendering:**
- `ggiraph.R` - Interactive ggplot2 extensions using ggiraph
- `tables.R` - Table rendering and formatting functions
- `svg.r` - SVG rendering and HTML output functions
- `svg.html` - HTML template for SVG rendering

**ggplot2 Extensions:**
- `geom_section.R` - Custom geom for section plots
- `ggdist.R` - Distribution visualization extensions
- `correlation_matrix.R` - Correlation matrix visualization
- `grouped_chisq.R` - Grouped chi-square test visualizations

**Package Infrastructure:**
- `generics.R` - S3 generic function definitions
- `imports.R` - Package import declarations
- `options.R` - Package-wide options and configuration
- `zzz.R` - Package startup and initialization functions
- `legacy-plot.R` - Legacy plotting functions for backward compatibility

**Specialized Functionality:**
- `arrangements.R` - Layout and arrangement functions for multiple plots
- `transformations.R` - Data transformation utilities

#### `/tests/` - Test Suite
Comprehensive test suite using the testthat framework:

- `testthat.R` - Main test runner configuration
- `testthat/` - Test files directory
  - `helper-test-utilities.R` - Test helper functions and utilities
  - `setup-test-data.R` - Test data setup and configuration
  - `test-*.R` - Individual test files covering different package components
  - `_snaps/` - Snapshot test files for visual regression testing
  - `testthat-problems.rds` - Test execution results cache

**Key Test Categories:**
- Security tests (`test-security-formula-construction.R`)
- Performance benchmarks (`test-performance-benchmarks.R`)
- Visual regression tests (`test-visual-regression.R`)
- R6 class validation (`test-r6-class-validation.R`)
- CRAN compliance tests (`test-cran-compliance.R`)

#### `/man/` - Documentation
Generated R documentation files (Rd format) created by roxygen2:
- One `.Rd` file per exported function/class
- `figures/` - Documentation figures and plots

#### `/vignettes/` - Package Vignettes
Long-form documentation and tutorials:
- `getting-started.Rmd` - Basic usage and introduction
- `advanced-features.Rmd` - Advanced functionality guide
- `statistical-visualization.Rmd` - Statistical plotting examples
- `performance-optimization.Rmd` - Performance tips and optimization
- `real-world-examples.Rmd` - Practical use cases
- `troubleshooting.Rmd` - Common issues and solutions

#### `/docs/` - pkgdown Website
Generated documentation website (do not edit manually):
- `reference/` - Function reference pages
- `news/` - News and changelog pages
- Static assets (CSS, JS, images)

#### `/inst/` - Installed Files
Files included with the installed package:
- `assets/` - Static assets (CSS, SVG icons)
- `styles/` - YAML style configuration files for different plot types
- `benchmarks/` - Performance benchmark scripts
- `testapp/` - Shiny test application

### Development and Build Files

#### `/worktrees/` - Git Worktrees
Isolated development environments for feature branches (created by development workflow)

#### `/logs/` - Development Logs
Development and debugging logs (not tracked in git)

#### Build Artifacts
- `baseline_*.log` - Baseline test and check results
- Various temporary build files

## Key Design Patterns

### R6 Class Architecture
The package is built around three main R6 classes providing method chaining and lazy evaluation:
- **Plot**: Main plotting with memoization for performance
- **Summary**: Statistical summaries with data aggregation
- **Coxph**: Survival analysis with Cox regression

### Security and Validation
- Formula construction includes security validation (`validation.R`, security tests)
- Comprehensive input validation throughout the package
- Error handling with custom error types

### Performance Optimization
- Memoization system for expensive operations
- Caching mechanisms for large datasets
- Performance benchmarks and monitoring

### Testing Strategy
- Unit tests for all major functions
- Visual regression tests for plot consistency
- Security tests for formula construction
- Performance benchmarks
- CRAN compliance validation

## File Naming Conventions

- **R files**: kebab-case for multi-word files (`grouped_chisq.R`)
- **Test files**: `test-` prefix with descriptive names
- **Documentation**: `.Rmd` for vignettes, `.Rd` generated for functions
- **Configuration**: UPPERCASE for package files (`DESCRIPTION`, `NAMESPACE`)

## Dependencies and External Resources

Key dependencies are managed through the DESCRIPTION file and include:
- **Visualization**: ggplot2, ggpubr, patchwork, reactable
- **Data manipulation**: dplyr, tidyr, purrr, magrittr  
- **Statistics**: survival, GGally
- **Interactive features**: ggiraph, htmltools
- **Performance**: memoise, furrr

This structure supports the package's role as a comprehensive statistical visualization toolkit for clinical research, with emphasis on declarative plotting, survival analysis, and interactive data exploration.